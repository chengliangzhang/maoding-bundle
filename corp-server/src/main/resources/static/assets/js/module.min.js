function dateDiff(t,n){return t&&null!=t&&""!=t&&n&&null!=n&&""!=n?Date.parse(t.toString().replace(/-/g,"/"))-Date.parse(n.toString().replace(/-/g,"/")):0}function getNowDate(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()<9?"0"+(t.getMonth()+1):t.getMonth()+1)+"-"+(t.getDate()<10?"0"+t.getDate():t.getDate())}function diffDays(t,n){var e=this.dateDiff(n,t);return Math.floor(e/864e5)}function getStringLength(t){for(var n=0,e=0;e<t.length;e++){var r=t.charCodeAt(e);r>=1&&r<=126||65376<=r&&r<=65439?n++:n+=2}return n}function handlePostJsonError(t){404==t.status?S_toastr.error("当前请求地址未找到！"):0==t.status?S_toastr.error("网络请求超时！"):S_toastr.error("网络请求出现错误！status："+t.status+"，statusText："+t.statusText)}function handleResponse(t){var n=!1;return"401"==t.code?(S_dialog.error("当前用户状态信息已超时!点击“确定”后返回登录界面。","提示",function(){window.location.href=rootPath+"/iWork/sys/login"}),n=!0):"500"==t.code&&(S_dialog.error("出现异常错误 !详细信息："+t.info),n=!0),n}function decimal(t,n){var e=Math.pow(10,n);return Math.round(t*e)/e}var restApi={url_syncCompany_selectAll:"/corpserver/syncCompany/selectAll",url_syncCompany_create:"/corpserver/syncCompany/create",url_syncCompany_delete:"/corpserver/syncCompany/delete",url_syncCompany_pushSyncAllCmd:"/corpserver/syncCompany/pushSyncAllCmd",url_companyDisk_recalcSizeByCompanyId:"/corpserver/companyDisk/recalcSizeByCompanyId",url_companyDisk_switchCorpDeployType:"/corpserver/companyDisk/switchCorpDeployType"},preventDefault=function(t){t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation=function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0},shortTime=function(t){return moment(t).format("HH:mm")},dateSpecFormat=function(t,n){var e=moment(new Date,"YYYY-MM-DD HH:mm:ss"),r=moment(new Date,"YYYY-MM-DD HH:mm:ss").subtract(1,"days"),a=moment(moment(t).toDate(),"YYYY-MM-DD HH:mm:ss"),o=e.format("YYYY-MM-DD"),i=r.format("YYYY-MM-DD"),s=a.format("YYYY-MM-DD"),c="";return c=o==s?"今天":i==s?"昨天":s,n&&!_.isBlank(n)?_.sprintf(n,c,a.format("HH:mm")):_.sprintf("%s %s",c,a.format("HH:mm"))},dateSpecShortFormat=function(t){var n=moment(new Date,"YYYY-MM-DD HH:mm:ss"),e=moment(new Date,"YYYY-MM-DD HH:mm:ss").subtract(1,"days"),r=moment(moment(t).toDate(),"YYYY-MM-DD HH:mm:ss"),a=n.format("YYYY-MM-DD"),o=e.format("YYYY-MM-DD"),i=r.format("YYYY-MM-DD");return a==i?"今天":o==i?"昨天":i},isNullOrBlank=function(t){return void 0===t||null===t||_.isBlank(t)};!function(){for(var t,n=function(){},e=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],r=e.length,a=window.console=window.console||{};r--;)t=e[r],a[t]||(a[t]=n)}(),$.fn.serializeObject=function(){var t={},n=this.serializeArray();return $.each(n,function(){void 0!==t[this.name]?(t[this.name].push||(t[this.name]=[t[this.name]]),t[this.name].push(this.value||"")):t[this.name]=this.value||""}),t},String.prototype.replaceAll=function(t,n){return this.replace(new RegExp(t,"gm"),n)};var cutString=function(t,n,e){if(isNullOrBlank(t))return"";for(var r=0,a="",o=0;o<t.length;o++){var i=t.charCodeAt(o);if(i>=1&&i<=126||65376<=i&&i<=65439?r++:r+=2,a+=t.charAt(o),r>=n)return a+e}return t},S_toastr={success:function(t){toastr.options={closeButton:!1,debug:!1,progressBar:!1,preventDuplicates:!1,positionClass:"toast-top-center",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr.success(t)},warning:function(t){toastr.options={closeButton:!1,debug:!1,progressBar:!1,preventDuplicates:!1,positionClass:"toast-top-center",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr.warning(t)},info:function(t){toastr.options={closeButton:!1,debug:!1,progressBar:!1,preventDuplicates:!1,positionClass:"toast-top-center",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"3000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr.info(t)},error:function(t){toastr.options={closeButton:!1,debug:!1,progressBar:!1,preventDuplicates:!1,positionClass:"toast-top-center",onclick:null,showDuration:"400",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"},toastr.error(t)}},S_swal={confirm:function(t){swal({title:t.title||"确定此操作吗?",text:t.text,type:"warning",showCancelButton:!0,confirmButtonColor:"#DD6B55",confirmButtonText:t.confirmButtonText||"确定",cancelButtonText:t.cancelButtonText||"取消",closeOnConfirm:t.closeOnConfirm||!1},function(){null!=t.callBack&&t.callBack()})},sure:function(t){swal({title:t.title||"确定此操作吗?",text:t.text,type:"success",confirmButtonText:t.confirmButtonText||"确定",closeOnConfirm:!0},function(){null!=t.callBack&&t.callBack()})}},m_ajax={get:function(t,n,e){$.ajax({type:"GET",url:t.url,cache:!1,beforeSend:function(){if(t.classId&&$_loading.show(t.classId,"正在加载中..."),t.bindDisabled){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!0)}catch(t){}try{n.prop("disabled",!0)}catch(t){}}}},success:function(t){handleResponse(t)||n&&n(t)},error:function(t){e&&e(),handlePostJsonError(t)},complete:function(){t.classId&&$_loading.close(t.classId),t.bindDisabled&&setTimeout(function(){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!1)}catch(t){}try{n.prop("disabled",!1)}catch(t){}}},1e3)}})},getJson:function(t,n,e){$.ajax({type:"GET",url:t.url,cache:!1,contentType:"application/json",beforeSend:function(){if(t.classId&&$_loading.show(t.classId,"正在加载中..."),t.bindDisabled){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!0)}catch(t){}try{n.prop("disabled",!0)}catch(t){}}}},success:function(t){handleResponse(t)||n&&n(t)},error:function(t){e&&e(),handlePostJsonError(t)},complete:function(){t.classId&&$_loading.close(t.classId),t.bindDisabled&&setTimeout(function(){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!1)}catch(t){}try{n.prop("disabled",!1)}catch(t){}}},1e3)}})},post:function(t,n,e){$.ajax({type:"POST",url:t.url,data:t.postData,cache:!1,beforeSend:function(){if(t.classId&&$_loading.show(t.classId,"正在加载中..."),t.bindDisabled){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!0)}catch(t){}try{n.prop("disabled",!0)}catch(t){}}}},success:function(t){handleResponse(t)||n&&n(t)},error:function(t){e&&e(),handlePostJsonError(t)},complete:function(){t.classId&&$_loading.close(t.classId),t.bindDisabled&&setTimeout(function(){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!1)}catch(t){}try{n.prop("disabled",!1)}catch(t){}}},1e3)}})},postJson:function(t,n,e){$.ajax({type:"POST",url:t.url,cache:!1,async:null==t.async||t.async,data:JSON.stringify(t.postData),contentType:"application/json",beforeSend:function(){if(t.classId&&$_loading.show(t.classId,"正在加载中..."),t.bindDisabled){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!0)}catch(t){}try{n.prop("disabled",!0)}catch(t){}}}},success:function(t){handleResponse(t)||n&&n(t)},error:function(t){e&&e(),handlePostJsonError(t)},complete:function(){t.classId&&$_loading.close(t.classId),t.bindDisabled&&setTimeout(function(){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!1)}catch(t){}try{n.prop("disabled",!1)}catch(t){}}},1e3)}})},delete:function(t,n,e){$.ajax({type:"DELETE",url:t.url,cache:!1,data:JSON.stringify(t.postData),contentType:"application/json",beforeSend:function(){if(t.classId&&$_loading.show(t.classId,"正在加载中..."),t.bindDisabled){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!0)}catch(t){}try{n.prop("disabled",!0)}catch(t){}}}},success:function(t){handleResponse(t)||n&&n(t)},error:function(t){e&&e(),handlePostJsonError(t)},complete:function(){t.classId&&$_loading.close(t.classId),t.bindDisabled&&setTimeout(function(){var n=$(t.bindDisabled);if(n.length>0){try{n.attr("disabled",!1)}catch(t){}try{n.prop("disabled",!1)}catch(t){}}},1e3)}})}},countDigits=function(t,n){var e=(t-0).toString().split("."),r=0;return e.length>1&&(r=e[1].length<n?e[1].length:n),r},doMath={accSub:function(t,n){var e,r,a,o;try{e=t.toString().split(".")[1].length}catch(t){e=0}try{r=n.toString().split(".")[1].length}catch(t){r=0}return a=Math.pow(10,Math.max(e,r)),o=e>=r?e:r,((t*a-n*a)/a).toFixed(o)},accAdd:function(t,n){var e,r,a;try{e=t.toString().split(".")[1].length}catch(t){e=0}try{r=n.toString().split(".")[1].length}catch(t){r=0}return a=Math.pow(10,Math.max(e,r)),(t*a+n*a)/a}};Number.prototype.sub=function(t){return parseFloat(doMath.accSub(this,t))},Number.prototype.add=function(t){return parseFloat(doMath.accAdd(this,t))},function(){function t(t,n){return(/string|function/.test(typeof n)?s:i)(t,n)}function n(t,e){return"string"!=typeof t&&(e=typeof t,"number"===e?t+="":t="function"===e?n(t.call(t)):""),t}function e(t){return d[t]}function r(t){return n(t).replace(/&(?![\w#]+;)|[<>"']/g,e)}function a(t,n){if(p(t))for(var e=0,r=t.length;e<r;e++)n.call(t,t[e],e,t);else for(e in t)n.call(t,t[e],e)}function o(t,n){var e=/(\/)[^\/]+\1\.\.\1/,r=("./"+t).replace(/[^\/]+$/,""),a=r+n;for(a=a.replace(/\/\.\//g,"/");a.match(e);)a=a.replace(e,"/");return a}function i(n,e){var r=t.get(n)||c({filename:n,name:"Render Error",message:"Template not found"});return e?r(e):r}function s(t,n){if("string"==typeof n){var e=n;n=function(){return new u(e)}}var r=l[t]=function(e){try{return new n(e,t)+""}catch(t){return c(t)()}};return r.prototype=n.prototype=f,r.toString=function(){return n+""},r}function c(t){var n="{Template Error}",e=t.stack||"";if(e)e=e.split("\n").slice(0,2).join("\n");else for(var r in t)e+="<"+r+">\n"+t[r]+"\n\n";return function(){return"object"==typeof console&&console.error(n+"\n\n"+e),n}}var l=t.cache={},u=this.String,d={"<":"&#60;",">":"&#62;",'"':"&#34;","'":"&#39;","&":"&#38;"},p=Array.isArray||function(t){return"[object Array]"==={}.toString.call(t)},f=t.utils={$helpers:{},$include:function(t,n,e){return t=o(e,t),i(t,n)},$string:n,$escape:r,$each:a},h=t.helpers=f.$helpers;t.get=function(t){return l[t.replace(/^\.\//,"")]},t.helper=function(t,n){h[t]=n},"function"==typeof define?define(function(){return t}):"undefined"!=typeof exports?module.exports=t:this.template=t,t.helper("_isNullOrBlank",function(t){return void 0===t||null===t||_.isBlank(t)}),t.helper("_formatFileSize",function(t){var n;return void 0===t||null===t?"":t<1024?t+"B":t<1048576?(n=parseFloat(t/1024).toFixed(3),n.substring(0,n.length-1)+"KB"):t<1073741824?(n=parseFloat(t/1048576).toFixed(3),n.substring(0,n.length-1)+"MB"):(n=parseFloat(t/1073741824).toFixed(3),n.substring(0,n.length-1)+"GB")}),t("m_setting/m_setting_list",function(t,n){"use strict";var e=this,r=e.$helpers,a=e.$each,o=t.list,i=(t.o,t.i,e.$escape),s=r._isNullOrBlank,c=r._formatFileSize,l="";return a(o,function(t,n){l+=" <tr> <td>",l+=i(t.corpEndpoint),l+="</td> <td>",l+=i(t.companyId),l+="</td> <td>",l+=i(s(t.companyName)?'<span style="color:red;">无法匹配</span>':t.companyName),l+="</td> <td>总空间：",l+=i(c(t.totalSize)),l+=" <br/> 协同：",l+=i(c(t.corpSize)),l+=" ",l+=i(!0===t.corpOnCloud?"（云端部署）":"（本地部署）"),l+=" <br/> 文档库：",l+=i(c(t.docmgrSize)),l+=" <br/> 其他：",l+=i(c(t.otherSize)),l+=" <br/> 可用空间：",l+=i(c(t.freeSize)),l+='<br/> <a name="btnSwitchDeployCorp" href="javacript:void(0)" data-company-id="',l+=i(t.companyId),l+='" class="btn btn-warning btn-xs">切换协同部署方式</a> <a name="btnRecalcSize" href="javacript:void(0)" data-company-id="',l+=i(t.companyId),l+='" class="btn btn-success btn-xs">重新统计文档库和其他</a><br/> </td> <td>',l+=i(t.remarks),l+='</td> <td> <a name="btnRemove" href="javacript:void(0)" data-id="',l+=i(t.id),l+='" class="btn btn-danger btn-sm ">删除</a>&nbsp;<a name="btnSync" href="javacript:void(0)" data-id="',l+=i(t.id),l+='" class="btn btn-success btn-sm ">立即同步</a> </td> </tr> '}),new u(l)})}(),function(t,n,e,r){"use strict";function a(t,n){this.element=t,this.settings=n,this._defaults=i,this._name=o,this.init()}var o="m_setting",i={};t.extend(a.prototype,{init:function(){this._render()},_render:function(){var n=this,e=template("xxx",{});t(n.element).html(e)}}),t.fn[o]=function(n,e){var r,s,c=this.each(function(){if(r=t.data(this,"plugin_"+o),void 0===n||null===n||"object"==typeof n){var c=t.extend(!0,{},i,n);!0===e?r=new a(this,c):void 0!==r&&null!==r||(r=new a(this,c)),t.data(this,"plugin_"+o,r)}else"string"==typeof n&&"function"==typeof r[n]&&(s=r[n].call(r,e))});return void 0===s?c:s}}(jQuery,window,document);var corpserver_setting={init:function(){var t=this;t.bindAdd(),t.refreshData()},refreshData:function(){var t=this,n={url:restApi.url_syncCompany_selectAll};m_ajax.getJson(n,function(n){if("0"===n.code){$("#tbody").html("");var e=template("m_setting/m_setting_list",{list:n.data});$("#tbody").append(e),t.bindAction()}else isNullOrBlank(n.msg)?S_toastr.error("数据请求失败"):S_toastr.error(n.msg)})},bindAdd:function(){var t=this;$("#btnAdd").click(function(){var n=$.trim($("#corpEndpoint").val()),e=$.trim($("#companyId").val()),r=$.trim($("#remarks").val()),a={url:restApi.url_syncCompany_create,postData:{corpEndpoint:n,companyId:e,remarks:r}};m_ajax.postJson(a,function(n){"0"===n.code?t.refreshData():isNullOrBlank(n.msg)?S_toastr.error("数据请求失败"):S_toastr.error(n.msg)})})},bindAction:function(){var t=this;$('a[name="btnSwitchDeployCorp"]').click(function(){var n=$(this).attr("data-company-id"),e={url:restApi.url_companyDisk_switchCorpDeployType,postData:{companyId:n}};m_ajax.postJson(e,function(n){"0"===n.code?t.refreshData():isNullOrBlank(n.msg)?S_toastr.error("数据请求失败"):S_toastr.error(n.msg)})}),$('a[name="btnRecalcSize"]').click(function(){var n=$(this).attr("data-company-id"),e={url:restApi.url_companyDisk_recalcSizeByCompanyId,postData:{companyId:n}};m_ajax.postJson(e,function(n){"0"===n.code?t.refreshData():isNullOrBlank(n.msg)?S_toastr.error("数据请求失败"):S_toastr.error(n.msg)})}),$('a[name="btnRemove"]').click(function(){var n=$(this).attr("data-id"),e={url:restApi.url_syncCompany_delete+"/"+n};m_ajax.postJson(e,function(n){"0"===n.code?t.refreshData():isNullOrBlank(n.msg)?S_toastr.error("数据请求失败"):S_toastr.error(n.msg)})}),$('a[name="btnSync"]').click(function(){var t=$(this).attr("data-id"),n={url:restApi.url_syncCompany_pushSyncAllCmd+"/"+t};m_ajax.postJson(n,function(t){"0"===t.code?S_toastr.success("已经发送同步指令，同步可能需要1-2分钟"):isNullOrBlank(t.msg)?S_toastr.error("数据请求失败"):S_toastr.error(t.msg)})})}};